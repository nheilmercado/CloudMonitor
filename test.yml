trigger:
- RK-PowerBi-Deployment

parameters:
- name: ServiceConn
  displayName: ServiceConn
  type: string
  default: PROD-Connection2
- name: PowerBiServiceConn
  displayName: PowerBiServiceConn
  type: string
  default: Power-bi conn
- name: groupvariables
  type: object
  default:
   - CloudMonitorSentis


stages:

- stage: 'DeployDB'
  displayName: 'Deploy to SQL Database'
  pool:
    name: DevOpsBuildAgentProdWindowsPool
  jobs:
  - ${{ each group in parameters.groupvariables }}:
      - job:
        displayName: 'Deploy to SQL Database'
        variables:
        
        - group: Release for Foundation Function Apps ${{ group }}
        - name: BiId
          value: ${{ variables.PowerBiClientId }}
        - name: BiKey
          value: ${{ variables.PowerBiClientSecretKey }}
        
        steps:
    
            - task: AzurePowerShell@5
              name: Updatecredentials
              inputs:
                azureSubscription: '${{ parameters.ServiceConn }}'
                ScriptType: 'InlineScript'
                Inline: |
                  Write-Host "##vso[task.setvariable variable=deployActivity]"Example string""
                  write-Host "$env:PowerBiClientId"
                  Write-Host "##vso[task.setvariable variable=BiId]"$env:PowerBiClientId""
                  
                azurePowerShellVersion: 'LatestVersion'
                pwsh: true
              
            - task: AzurePowerShell@5
              name: Updatecredentials2
              inputs:
                azureSubscription: '${{ parameters.ServiceConn }}'
                ScriptType: 'InlineScript'
                Inline: |
                   Write-Host "Deploy Activity: $(deployActivity)"
                   Write-Host "Variable : $(BiId)"
                  
                azurePowerShellVersion: 'LatestVersion'
                pwsh: true