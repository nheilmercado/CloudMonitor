trigger:
- RK-PowerBi-Deployment

parameters:
- name: ServiceConn
  displayName: ServiceConn
  type: string
  default: PROD-Connection2
- name: PowerBiServiceConn
  displayName: PowerBiServiceConn
  type: string
  default: Power-bi conn
- name: groupvariables
  type: object
  default:
   - CloudMonitorSentis


stages:

- stage: 'DeployDB'
  displayName: 'Deploy to SQL Database'
  pool:
    name: DevOpsBuildAgentProdWindowsPool
  jobs:
  - ${{ each group in parameters.groupvariables }}:
      - job:
        displayName: 'Deploy to SQL Database'
        variables:
        - name: sdkVersion
          value: initialValue 
        steps:
        - task: AzurePowerShell@5
          displayName: 'Update credentials'
          inputs:
            azureSubscription: '${{ parameters.ServiceConn }}'
            ScriptType: 'InlineScript'
            Inline: |
              $version1 = '7638c835-dbd4-49e4-ad77-3f890758f7f5'
              
              Write-Host "##vso[task.setvariable variable=sdkVersion]$version1" 
              
              Write-Host "Setted variable"
            azurePowerShellVersion: 'LatestVersion'
            pwsh: true
        - task: CmdLine@2
          inputs:
            script: |
              echo ${{ variables.sdkVersion }}
              echo Hello world
